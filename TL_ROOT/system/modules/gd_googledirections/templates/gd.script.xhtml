<?php /* the script below requires MooTools */ ?>
<script type="text/javascript">

</script>

<script type="text/javascript">
var labels = {
	invalidRequest: '<?php echo $this->invalidRequest; ?>',
	maxWaypointExceeded: '<?php echo $this->maxWaypointExceeded; ?>',
	notFound: '<?php echo $this->notFound; ?>',
	overQueryLimit: '<?php echo $this->overQueryLimit; ?>',
	requestDenied: '<?php echo $this->requestDenied; ?>',
	zeroResults: '<?php echo $this->zeroResults; ?>',
	defaultError: '<?php echo $this->defaultError; ?>'
}
<?php if ($this->marker) : ?>
var markerMap = 
{
	markerCoords: '<?php echo $this->marker_coords; ?>',
	<?php if ($this->icon) : ?>
	icon: 
	{
		url: '<?php echo $this->icon; ?>',
		size: 
		{
			x: '<?php echo $this->iconsize[0]; ?>',
			y: '<?php echo $this->iconsize[1]; ?>'
		},
		anchor: 
		{
			x: '<?php echo $this->iconanchor[0]; ?>',
			y: '<?php echo $this->iconanchor[1]; ?>'
		}
	}
	<?php if ($this->shadow || (is_array($this->shadow) && sizeof($this->shadow) < 1)) : ?>
	,
	shadow: 
	{
		url: '<?php echo $this->shadow; ?>',
		size: 
		{
			x: '<?php echo $this->shadowsize[0]; ?>',
			y: '<?php echo $this->shadowsize[1]; ?>'
		},
		anchor: 
		{
			x: '<?php echo $this->iconanchor[0]; ?>',
			y: '<?php echo $this->iconanchor[1]; ?>'
		}
	}
	<?php if ($this->infowindow) : ?>
	,
	infoWindow: 
	{
		content: '<?php echo $this->infowindow_text; ?>',
		anchor: 
		{
			x: '<?php echo $this->infowindow_anchor[0]; ?>',
			y: '<?php echo $this->infowindow_anchor[1]; ?>'
		},
		autoOpen: <?php echo $this->infowindow_auto; ?>
	}
	<?php endif; ?>
	<?php endif; ?>
	<?php endif; ?>
}
var gd = new GDGoogleDirections(<?php echo $this->moduleId; ?>, labels,markerMap);
<?php else: ?>
var gd = new GDGoogleDirections(<?php echo $this->moduleId; ?>, labels);
<?php endif; ?>

   <?php

	$initialFrom = ($this->from_coords) ? $this->from_coords : $this->from;
	$initialVia = ($this->via_coords) ? $this->via_coords : $this->via;
	$initialTo = ($this->to_coords) ? $this->to_coords : $this->to;

	$isFromPreset = strlen($initialFrom) > 0;
	$isToPreset = strlen($initialTo) > 0;

	// at least one value needs to be preset
	if($isFromPreset || $isToPreset): ?>
		window.addEvent('domready', function() {
		<?php if($isFromPreset && $isToPreset): ?>
			<?php
			if($this->add_via): ?>
				gd.setDirections(new Array('<?php echo $initialFrom; ?>', '<?php echo $initialVia; ?>', '<?php echo $initialTo; ?>'));
			<?php else: ?>
				gd.setDirections(new Array('<?php echo $initialFrom; ?>', '<?php echo $initialTo; ?>'));
			<?php endif; ?>
	    <?php elseif($this->show_single_point): ?>
			<?php if($this->from_coords): ?>
				gd.showMapForSinglePoint(new GLatLng(<?php echo $this->from_coords; ?>));
			<?php elseif($this->from): ?>
				gd.setDirections(new Array('<?php echo $this->from; ?>'));
			<?php elseif($this->to_coords): ?>
				gd.showMapForSinglePoint(new GLatLng(<?php echo $this->to_coords; ?>));
			<?php else: ?>
				gd.setDirections(new Array('<?php echo $this->to; ?>'));
			<?php endif;?>
		<?php endif; ?>
		});
    <?php endif; ?>
</script>